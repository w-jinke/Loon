#!name=哔哩哔哩
#!desc=屏蔽客户端广告并精简UI
#!icon=https://i.pinimg.com/736x/f8/a4/de/f8a4de822bdd6ff9924d01d2ec9e8ff7.jpg

[Argument]
purifyTopReplies=switch, true, tag=移除评论广告

[Rewrite]
^https:\/\/api\.bilibili\.com\/x\/vip\/ads\/materials reject-200
^https:\/\/app\.bilibili\.com\/x\/v2\/splash\/(list|show|event\/list2)\? response-body-json-jq '.data|= with_entries(if .key | IN("show", "event_list") then .value = [] else . end)'
^https:\/\/app\.bilibili\.com\/x\/v2\/search response-body-json-jq '.data|= map(select(.type!="recommend")|del(.search_ranking_meta))'
^https:\/\/app\.bilibili\.com\/x\/v2\/feed\/index\? response-body-json-jq '.data.items|= map(select(.rcmd_reason=="竖屏" or .card_goto=="av" ))'
^https:\/\/app\.bilibili\.com\/x\/v2\/feed\/index\/story response-body-json-jq '.data.items|= map(select(.goto=="vertical_av"))'
^https:\/\/app\.bilibili\.com\/x\/resource\/show\/tab\/v2 response-body-json-jq '.data.tab|= [(.[]|select(.id==40)),(.[]|select(.id==41)),(.[]|select(.id==3502)),(.[]|select(.id==3503)),(.[]|select(.id==39))]|.data.bottom|=map(select(.id|IN(177,179,181)))|.data.top|=map(select(.id==3510))|.data.top_more=[]|.data.top_left=[]'
^https:\/\/app\.bilibili\.com\/x\/v2\/account\/mine\? response-body-json-jq '.data.sections_v2|= map(if .style==1 and .items[0].id>=396 and .items[0].id<=399 then . elif .style==2 then .items |= map(select(.id==407 or .id==410)|if .id==410 then .title="我的设置" else . end)|del(.title) else empty end) | .data.modular_vip_section={}'
^https:\/\/app\.bilibili\.com\/x\/v2\/account\/mine\/ipad response-body-json-jq '.data.ipad_recommend_sections|= map(select(.id|IN(758,759,760,792,793,2542,794)|not))|.data.ipad_more_sections|=map(select(.id|IN(1070,965)|not)|if .id==798 then .title="我的设置" else . end)|del(.data.ipad_upper_sections)'

[Script]
http-response ^https:\/\/(grpc\.biliapi\.net|app\.bilibili\.com)\/bilibili\.(app\.(show\.v1\.Popular\/Index|dynamic\.v2\.Dynamic\/DynAll|view(unite)?\.v1\.View\/(View|ViewProgress|RelatesFeed)|playurl\.v1\.PlayURL\/PlayView|playerunite\.v1\.Player\/PlayViewUnite)|polymer\.app\.search\.v1\.Search\/SearchAll|community\.service\.dm\.v1\.DM\/DmView|main\.community\.reply\.v1\.Reply\/MainList|pgc\.gateway\.player\.v2\.PlayURL\/PlayView)$ script-path=https://raw.githubusercontent.com/kokoryh/Sparkle/master/dist/bilibili.protobuf.response.js, requires-body=true, binary-body-mode=true, tag=广告处理, argument=[{purifyTopReplies}]

[MitM]
hostname = grpc.biliapi.net,app.bilibili.com,api.bilibili.com
